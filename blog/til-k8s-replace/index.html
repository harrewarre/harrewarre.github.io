<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>harre.dev | Today I learned - kubectl replace</title>
    <link rel="stylesheet" href="/assets/style/theme.css">
    <link rel="stylesheet" href="/assets/style/prism-okaidia.css">
  </head>
  <body>
    <main>
    <header>
      <h1>
        <a href="/">harre.dev</a>
      </h1>
    </header>
    <nav>
      <a href="/">home</a>
      <a href="/blog">blog</a>
      <a href="/about">about</a>
      <a href="/feed.xml">rss</a>
    </nav>
      
<article>
    <div>2022-11-21 </div>
    <h1>Today I learned - kubectl replace</h1>
<p>Here's one for your toolbox, but use with care. Say you have an app running on kubernetes in a pod and you spot something you want to change. This is one way to get it done.</p>
<p>For the example, I spun up an nginx server called <code>webapp</code>.</p>
<p>The command to edit a resource running on kubernetes is <code>kubectl edit &lt;thing&gt; &lt;name&gt;</code>. So here goes:</p>
<p>kubectl edit pod webapp</p>
<p>You'll see a whole bunch of yaml that represents the pods definition. In what editor will depend on what you've set as your default editor for any <code>kubectl</code> related business. (See: <code>KUBE_EDITOR</code> environment variable).</p>
<p># Please edit the object below. Lines beginning with a '#' will be ignored,
# and an empty file will abort the edit. If an error occurs while saving this file will be
# reopened with the relevant failures.
#
apiVersion: v1
kind: Pod
metadata:
creationTimestamp: &quot;2022-11-21T18:51:24Z&quot;
labels:
run: webapp
name: webapp
namespace: default
spec:
containers:
- image: nginx
name: webapp</p>
<p><small>Shortened for sanity</small></p>
<p>Now you can make any changes you want and when you save them, they'll get applied to the resource you started editting. Not so fast though. You're not allowed to just update anything and apply it!</p>
<p>resources:
requests:
memory: 128M
limits:
memory: 512M</p>
<p>If for example you try to set resource limits you'll get an error.</p>
<p># pods &quot;webapp&quot; was not valid:
# * spec: Forbidden: pod updates may not change fields other than <code>spec.containers[*].image</code>, <code>spec.initContainers[*].image</code>, <code>spec.activeDeadlineSeconds</code>... <snipped></p>
<p>If you close out of the editor and go back to the CLI you'll see this message:</p>
<p>A copy of your changes has been stored to &quot;/tmp/kubectl-edit-4134617318.yaml&quot;
error: Edit cancelled, no valid changes were saved.</p>
<p>See that? They saved our changes in a temporary file. Let's say your really really wanted to apply these changes. Here you go:</p>
<p>kubectl replace -f /tmp/kubectl-edit-4134617318.yaml --force</p>
<p>Doing the above will cause two things. The first is: <strong>it will delete the running pod we had in the definition</strong>. The second thing is, <strong>it will replace</strong> the thing we had with whatever we have in our temporary definition.</p>
<p>pod &quot;webapp&quot; deleted
pod/webapp replaced</p>
<p>As you can see, it's quite destructive, but for local development and a bit of hacking around this is a nice quick and dirty way to recreate something with different parameters quickly.</p>

    <div class="tags">
        
            today-i-learned
        
            kubernetes
        
            kubectl
        
    </div>
</article>

    <footer>
      <p>Â© 2025 harre.dev</p>
    </footer>
    </main>
  </body>
</html>
